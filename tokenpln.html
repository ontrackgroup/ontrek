<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Token PLN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
        integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Cardo:ital,wght@0,400;0,700;1,400&family=Courgette&family=Honk&family=Pacifico&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Rubik+Doodle+Shadow&family=Viga&display=swap"
        rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <style>
        :root {
            --my-color: #ff6f00;
        }

        body {
            font-family: "Poppins", sans-serif;
            background: aliceblue;
        }

        header {
            position: absolute;
            top: 0;
            width: 100%;
            z-index: -999;
            height: 80px;
            background: var(--my-color);
        }

        .gx-input1 {
            border: 2px solid #eaeaea;
        }

        .gx-input1:focus {
            border: 2px solid var(--my-color);
            box-shadow: none;
        }

        .product-container {
            grid-template-columns: auto 1fr;
            grid-column-gap: 10px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background-image: url("https://telegra.ph/file/4ad7e10cc2932f97b31c2.jpg");
        }

        .product-container:active {
            transform: scale(1.05);
        }

        .card-img-start {
            width: 40px;
            height: 40px;
        }

        a {
            color: #000000;
            text-decoration: none;
        }

        .loader {
            color: #3939ab;
            font-size: 10px;
            width: 1em;
            height: 1em;
            border-radius: 50%;
            position: relative;
            text-indent: -9999em;
            animation: mulShdSpin 1.3s infinite linear;
            transform: translateZ(0);
        }

        @keyframes mulShdSpin {

            0%,
            100% {
                box-shadow:
                    0 -3em 0 0.2em,
                    2em -2em 0 0em,
                    3em 0 0 -1em,
                    2em 2em 0 -1em,
                    0 3em 0 -1em,
                    -2em 2em 0 -1em,
                    -3em 0 0 -1em,
                    -2em -2em 0 0;
            }

            12.5% {
                box-shadow:
                    0 -3em 0 0,
                    2em -2em 0 0.2em,
                    3em 0 0 0,
                    2em 2em 0 -1em,
                    0 3em 0 -1em,
                    -2em 2em 0 -1em,
                    -3em 0 0 -1em,
                    -2em -2em 0 -1em;
            }

            25% {
                box-shadow:
                    0 -3em 0 -0.5em,
                    2em -2em 0 0,
                    3em 0 0 0.2em,
                    2em 2em 0 0,
                    0 3em 0 -1em,
                    -2em 2em 0 -1em,
                    -3em 0 0 -1em,
                    -2em -2em 0 -1em;
            }

            37.5% {
                box-shadow:
                    0 -3em 0 -1em,
                    2em -2em 0 -1em,
                    3em 0em 0 0,
                    2em 2em 0 0.2em,
                    0 3em 0 0em,
                    -2em 2em 0 -1em,
                    -3em 0em 0 -1em,
                    -2em -2em 0 -1em;
            }

            50% {
                box-shadow:
                    0 -3em 0 -1em,
                    2em -2em 0 -1em,
                    3em 0 0 -1em,
                    2em 2em 0 0em,
                    0 3em 0 0.2em,
                    -2em 2em 0 0,
                    -3em 0em 0 -1em,
                    -2em -2em 0 -1em;
            }

            62.5% {
                box-shadow:
                    0 -3em 0 -1em,
                    2em -2em 0 -1em,
                    3em 0 0 -1em,
                    2em 2em 0 -1em,
                    0 3em 0 0,
                    -2em 2em 0 0.2em,
                    -3em 0 0 0,
                    -2em -2em 0 -1em;
            }

            75% {
                box-shadow:
                    0em -3em 0 -1em,
                    2em -2em 0 -1em,
                    3em 0em 0 -1em,
                    2em 2em 0 -1em,
                    0 3em 0 -1em,
                    -2em 2em 0 0,
                    -3em 0em 0 0.2em,
                    -2em -2em 0 -1em;
            }

            87.5% {
                box-shadow:
                    0em -3em 0 0,
                    2em -2em 0 -1em,
                    3em 0 0 -1em,
                    2em 2em 0 -1em,
                    0 3em 0 -1em,
                    -2em 2em 0 0,
                    -3em 0em 0 0,
                    -2em -2em 0 0.2em;
            }
        }

        /* Sidebar CSS */
        .sidebar {
            position: fixed;
            bottom: -480px;
            /* Jarak sidebar dari sisi kiri layar */
            width: 100%;
            /* Lebar sidebar */
            background-color: #fff;
            border-right: 1px solid #ccc;
            transition: 0.3s;
            /* 0.5 second transition effect to slide in the sidebar */

            z-index: 1050;
            /* Pastikan z-index lebih tinggi dari konten lainnya */
        }

        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid #ccc;
        }

        .sidebar-body {

            padding: 1rem;

        }

        .sidebar.active {
            bottom: 0;
            /* Sidebar muncul saat left bernilai 0 */
        }

        body.sidebar-active {
            overflow: hidden;
            /* Menghilangkan kemampuan untuk menggulir */
        }

        .sidebar-active::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            /* Warna latar belakang yang gelap */
            z-index: 1040;
            /* Pastikan z-index lebih rendah dari sidebar */
        }


        .hidden {
            display: none;
        }

        .show {
            display: block;
        }

        .icon-with-margin {
            margin-right: 5px;
        }

        .collapse {
            border: none !important;
            background: transparent;
        }

        .gx-input-1 {
            border: 2px solid #eaeaea;
        }

        .gx-input-1:focus {
            border: 2px solid var(--my-color);
            box-shadow: none;
        }

        .width-25px {
            width: 60%;
        }

        .gx-button-costum {
            border: none;
            background: transparent;
            padding: 4px 0;
            font-weight: 400;
            color: #000000;
        }

        .gx-button-costum.active {
            background: var(--my-color);
            color: #fff;
        }

        .f-grid {
            display: grid;
        }

        .notification {
            background-color: #f44336;
            color: white;
            padding: 10px;
            margin-top: 10px;
        }

        .visible {
            display: block;
        }
    </style>
</head>

<body>
    <header> </header>
    <div class="container">
        <div class="shadow border border-2 border-light p-3 my-2 rounded" style="background-color: var(--my-color);">
            <div class="text-light mb-1">Tujuan</div>
            <div class=" d-flex">
                <input type="tel" id="userId" class="form-control mb-3 gx-input1 {{hasil_kontak}} {{hasil_scan}}"
                    placeholder="Masukan No Meter" />
                <a href="https://ontrackppob.my.id/scan_barcode">
                    <img src="https://cdn-icons-png.flaticon.com/128/8848/8848876.png" class="gx-img-test1"
                        style="width: 25px; height: 25px; margin-top: 6px; margin-left: 9px" />
                </a>
            </div>
            <div class="text-white">
                <div style="display: flex">
                    <div class="modal-label" style="font-size: 12px; font-weight: bold">Nama :</div>
                    <div class="modal-value" style="font-size: 13px; margin-left: 3px" id="result">
                        xxxxxxxx
                    </div>
                </div>
                <div style="display: flex; border-top: 1px dashed #333">
                    <div class="modal-label" style="font-size: 12px; font-weight: bold">Power :</div>
                    <div class="modal-value" style="font-size: 13px; margin-left: 3px" id="powerid">
                        xxxxxxxx
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="container">

        <div class=" p-1 my-2   rounded">

            <div class="gx-icon d-flex align-items-center">
                <div class="col fw-semibold">Pilihan Produk</div>
                <!-- Image button for List Dan Grid -->
                <img style="height: 20px;" src="https://cdn-icons-png.flaticon.com/128/151/151917.png" id="toggleImage"
                    alt="List Icon" />
            </div>

        </div>

    </div>

    <div class="container">
        <div class="row animate__animated animate__fadeInLeft" id="productList" onclick="checkNickname()">
            <!-- Product items will be appended here -->
            <div class="container d-flex justify-content-center align-items-center vh-100">
                <div id="loading"></div>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="fixed-bottom container py-2 bg-primary-subtle">
        <div class="d-flex">
            <div class="col mb-2" id="productName">Belum ada item terpilih</div>
            <div id="productPrice">Rp 0</div>
        </div>
        <button type="button" id="buyButton" class="btn w-100 fw-semibold text-white"
            style="background-color: var(--my-color);">
            Lanjut Pembayaran
        </button>
    </div>
    <!-- End Sidebar -->

    <script>
        var token = "eyJhcHAiOiIzMzkzMyIsImF1dGgiOiIyMDIwMDkwMyIsInNpZ24iOiI2NWhOM1dQQVRpTkZ1RzlEYU5MNVlnPT0ifQ==";

        $(document).ready(function () {
            let allProducts = [];
            let selectedProduct = {};
            let isListView = true;
            var ka = "550446";

            var changeKaButtons = document.querySelectorAll(".gx-button-costum"); // Tombol-tombol untuk mengubah nilai ka

            function toggleView() {
                isListView = !isListView;
                displayProducts();
                let toggleImage = $("#toggleImage");
                toggleImage.attr(
                    "src",
                    isListView ?
                        "https://cdn-icons-png.flaticon.com/128/151/151917.png" :
                        "https://cdn-icons-png.flaticon.com/128/238/238910.png"
                );
                toggleImage.attr("alt", isListView ? "List View" : "Grid View");

                // Menambah atau menghapus kelas d-block berdasarkan isListView
                $(".product-container").toggleClass("d-block", !isListView);
            }

            $("#toggleImage").click(function () {
                toggleView();
            });

            function fetchData(page) {
                $.ajax({
                    url: `https://openapi.bukaolshop.net/v1/app/produk?token=${token}&page=${page}&id_kategori=${ka}`,
                    method: "GET",
                    success: function (response) {
                        allProducts.push(...response.data);
                        displayProducts();
                    },
                    beforeSend: function () {
                        $("#loading").html('<div class="loader"></div>');
                    },
                    complete: function () { }
                });
            }

            function showProductDetails() {
                $("#productName").text(selectedProduct.nama_produk);
                $("#productPrice").text(selectedProduct.formattedPrice);
                $("#productDescription").text(selectedProduct.deskripsi_panjang);
                $("#productImage").attr("src", selectedProduct.url_gambar_produk); // Menambahkan gambar produk
                $("#buyButton").attr("href", `${selectedProduct.url_produk}?catatan=${$("#userId").val()}`);
                openSidebar(); // Membuka sidebar saat detail produk ditampilkan
            }

            $(document).ready(function () {
                $("#searchInput").on("keyup", function () {
                    var searchTerm = $(this).val().toLowerCase();
                    var found = false;

                    $(".product-container").each(function () {
                        var productName = $(this).text().toLowerCase();

                        if (productName.includes(searchTerm)) {
                            found = true;
                            if (isListView) {
                                $(this).removeClass("d-none").addClass("d-grid");
                            } else {
                                $(this).removeClass("d-none").addClass("d-block");
                            }
                        } else {
                            $(this).removeClass("d-block d-grid").addClass("");
                        }
                    });
                    if (!found) {
                        Swal.fire({
                            text: "No Products Found.",
                            position: "top",
                            showConfirmButton: false,
                            timer: 1500,
                            background: "#ffcccc",
                            showClass: {
                                popup: "animate__animated animate__fadeInDown"
                            },
                            customClass: {
                                popup: "animate__animated animate__fadeInDown bg-danger text-white rounded-4 width-25px"
                            }
                        });
                        $("#searchInput").val(""); // Hapus teks dari input
                        $(".product-container").removeClass("d-none");
                        if (isListView) {
                            $(".product-container").addClass("d-grid");
                        } else {
                            $(".product-container").addClass("d-block");
                        }
                    }
                });
            });

            function displayProducts() {
                allProducts.sort((a, b) => a.harga_produk - b.harga_produk);
                $("#productList").empty();
                $("#loading").empty();

                $.each(allProducts, function (index, product) {
                    let item = isListView ?
                        `<div class="col-12 mb-3"> ` :
                        `<div class="col-6 mb-3"> `;
                    let formattedPrice = new Intl.NumberFormat("id-ID", {
                        style: "currency",
                        currency: "IDR",
                        maximumFractionDigits: 0
                    }).format(product.harga_produk);

                    item += `
            <a href="#" class="product-sidebar" data-id="${index}">
                <div class="d-flex product-container f-grid animate__animated animate__fadeIn align-items-center">
                    <img src="${product.url_gambar_produk}" class="product rounded-1 " alt="${product.nama_produk}" style="width:40px;height:40px;">
                    <div class="card-body">
                        <h5 class="card-title mt-1" style="font-size:14px;font-weight:600;">${product.nama_produk}</h5>
                        <p class="card-text" style="font-size:14px;color:#666;font-weight:600;">${product.deskripsi_singkat}</p>
                        <p class="card-text" style="font-size:14px;color:#3949ab;font-weight:600;margin-top:-18px;">${formattedPrice}</p>
                    </div>
                </div>
            </a>`;
                    $("#productList").append(item);
                });

                $(".product-sidebar").click(function (e) {
                    e.preventDefault();
                    let productId = $(this).data("id");
                    selectedProduct = {
                        nama_produk: allProducts[productId].nama_produk,
                        formattedPrice: new Intl.NumberFormat("id-ID", {
                            style: "currency",
                            currency: "IDR",
                            maximumFractionDigits: 0
                        }).format(allProducts[productId].harga_produk),
                        url_produk: allProducts[productId].url_produk
                    };
                    showProductDetails();
                });
            }

            $("#buyButton").click(function () {
                let productUrl = $(this).attr("href");
                var input = document.getElementById("userId").value;
                if (input === "") {
                    Swal.fire({
                        text: "Input Harus Di Isi.",
                        position: "top",
                        showConfirmButton: false,
                        timer: 1500,
                        background: "#ffcccc",
                        showClass: {
                            popup: "animate__animated animate__fadeInDown"
                        },
                        customClass: {
                            popup: "animate__animated animate__fadeInDown bg-danger text-white rounded-4 width-25px"
                        }
                    });

                } else {
                    window.location.href = productUrl;
                }
            });

            // Fungsi untuk menampilkan animasi loading
            function showLoading() {
                $("#loading").html('<div class="loader"></div>');
            }

            // Fungsi untuk menyembunyikan animasi loading
            function hideLoading() {
                $("#loading").empty();
            }

            // Fungsi untuk mengubah nilai ka
            function changeKa(value) {
                ka = value;
                allProducts = []; // Mengosongkan array produk
                showLoading(); // Menampilkan animasi loading saat data dimuat
                for (let page = 1; page <= 5; page++) {
                    fetchData(page); // Memuat produk baru sesuai dengan ka yang baru
                    // Menyesuaikan kelas d-block berdasarkan mode tampilan
                    if (!isListView) {
                        toggleView();
                    }
                }
            }

            $(document).ready(function () {
                for (let page = 1; page <= 5; page++) {
                    fetchData(page);
                }
            });
        });
    </script>

    <script>
        function toggleInput() {
            var input = document.getElementById("input");
            var icon = document.getElementById("icon");

            if (icon.classList.contains("fa-search")) {
                icon.classList.remove("fa-search");
                icon.classList.add("fa-times");
            } else {
                icon.classList.remove("fa-times");
                icon.classList.add("fa-search");
            }
        }
    </script>

    <script>
        document.getElementById("productList").addEventListener("click", updateNumber);

        function updateNumber() {
            var userInput = document.getElementById("userId").value.trim();
            // Get user input
            var namaElement = document.getElementById("productName");
            var hargaElement = document.getElementById("productPrice");
            if (userInput === "") {
                namaElement.innerText = "Masukkan Id pelanggan";
                hargaElement.innerText = "";
                namaElement.style.color = "red"; // Set text color to red
            } else {
                namaElement.Text = namaElement;
                hargaElement.Text = hargaElement;
                namaElement.style.color = "black"; // Set text color to black
            }
        }
    </script>
    <script>
        $(document).ready(function () {
            $(".gx-button-test").click(function () {
                var title = $(this).data("title");
                var image = $(this).data("image");
                $("#productTitle").text(title);
                $("#productImageTitle").attr("src", image);
            });
        });
    </script>
    <script>
        function showSegmentPowerModal(power) {
            console.log("Segment Power Modal: " + power);
        }
        document.addEventListener("DOMContentLoaded", function () {
            const noInput = document.getElementById("userId");
            noInput.addEventListener("input", getData);
        });

        function getData() {
            const noValue = document.getElementById("userId").value;
            const keyValue = "11bbaeb7d98a3db";
            const billEndpoint = "pln";

            fetch(`https://cekid.lapakpayment.my.id/v2/bill/${billEndpoint}/?no=${noValue}&key=${keyValue}`)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(`Kesalahan HTTP! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then((data) => {
                    const nicknameModal = document.getElementById("result");
                    const powerModal = document.getElementById("powerid");

                    const nickname = data.nickname || "Loading";
                    const power = data.segment_power || "Loading";

                    nicknameModal.textContent = nickname;
                    powerModal.textContent = power;
                    showSegmentPowerModal(power);
                })
                .catch((error) => console.error("Kesalahan:", error));
        }
        document.getElementById("a").click();
    </script>
</body>

</html>